<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RU Attendance • Student</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --ru-red:#cc0033; --ru-red-600:#b3002c; --ring:rgba(204,0,51,.28);
    --text:#e5e7eb; --ink:#0b0c0e;
    --bg-img: url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=2000&auto=format&fit=crop');
    --card: rgba(255,255,255,.12);
    --card-border: rgba(255,255,255,.22);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans"; background:#0b0c0e; color:#111827; overflow-x:hidden}

  /* Topbar */
  .topbar{position:fixed; inset:0 0 auto 0; height:64px; z-index:20; display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 18px; color:#fff; background:linear-gradient(180deg, rgba(0,0,0,.6), rgba(0,0,0,0)); backdrop-filter:saturate(120%) blur(2px)}
  .brand{display:flex; align-items:center; gap:12px; color:#fff; text-decoration:none}
  .brand-logo{width:36px; height:36px; display:grid; place-items:center; border-radius:10px; background:var(--ru-red); color:#fff; font-weight:800; letter-spacing:.3px; box-shadow:0 8px 24px rgba(204,0,51,.45)}
  .brand span{font-weight:700}
  .btn{appearance:none; border:1px solid transparent; border-radius:12px; padding:10px 14px; font-weight:700; font-size:14px; display:inline-flex; align-items:center; gap:8px; text-decoration:none; transition:.2s; cursor:pointer}
  .btn.outline{color:#fff; border-color:rgba(255,255,255,.25); background:rgba(0,0,0,.25)}
  .btn.white{background:#fff; color:#111827}
  .btn.ru{background:var(--ru-red); color:#fff}
  .btn.ru:hover{background:var(--ru-red-600); transform:translateY(-1px)}
  .top-actions{display:flex; gap:10px}

  /* Full-bleed background */
  .cover{position:relative; min-height:100vh; display:grid; grid-template-columns:minmax(0,1fr); align-items:start; padding:64px 18px 32px; isolation:isolate}
  .cover::before{content:""; position:absolute; inset:0; z-index:-2; background-image:var(--bg-img); background-size:cover; background-position:center; background-repeat:no-repeat; transform:scale(1.02)}
  .cover::after{content:""; position:absolute; inset:0; z-index:-1; background:radial-gradient(1000px 600px at 10% -10%, rgba(204,0,51,.18), transparent 55%), linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.65) 55%, rgba(0,0,0,.85))}

  .wrap{width:min(1200px,94vw); margin:0 auto; display:grid; gap:22px}

  /* Glass cards */
  .glass{color:#fff; border-radius:22px; overflow:hidden; background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.12); box-shadow:0 25px 80px rgba(0,0,0,.45); padding:24px}
  .card{background:var(--card); border:1px solid var(--card-border); color:#fff; border-radius:18px; padding:20px; backdrop-filter: blur(8px) saturate(120%); box-shadow:0 18px 70px rgba(0,0,0,.45)}
  .heading{margin:0 0 6px; font-size:28px}
  .muted{color:#e5e7ebcc}
  .grid{display:grid; gap:16px; grid-template-columns: repeat(3,1fr)}
  @media (max-width:980px){.grid{grid-template-columns:1fr 1fr}}
  @media (max-width:620px){.grid{grid-template-columns:1fr}}

  /* Subject card */
  .subject{display:flex; flex-direction:column; gap:12px}
  .subject .title{display:flex; align-items:baseline; justify-content:space-between; gap:12px}
  .code{font-weight:800; letter-spacing:.3px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.25); padding:6px 10px; border-radius:999px}
  .big{font-size:18px; font-weight:800}
  .stat{font-weight:700}
  .bar{height:10px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden; border:1px solid rgba(255,255,255,.25)}
  .bar > span{display:block; height:100%; background:linear-gradient(90deg, #22c55e, #84cc16); width:0}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.28); background:rgba(0,0,0,.25); color:#fff; text-decoration:none; font-weight:700; cursor:pointer}
  .pill:hover{border-color:#fff}

  /* Table */
  table{width:100%; border-collapse:separate; border-spacing:0 10px}
  th, td{padding:12px 14px; text-align:left; color:#fff}
  thead th{font-size:13px; color:#e5e7ebcc; font-weight:700}
  tbody tr{background:var(--card); border:1px solid var(--card-border)}
  tbody tr td:first-child{border-radius:12px 0 0 12px}
  tbody tr td:last-child{border-radius:0 12px 12px 0}

  .kpi{display:flex; gap:14px; flex-wrap:wrap}
  .kpi .bubble{display:flex; flex-direction:column; gap:6px; background:var(--card); border:1px solid var(--card-border); border-radius:14px; padding:14px 16px}
  .kpi .value{font-size:22px; font-weight:800}
  .right{margin-left:auto; display:flex; gap:10px}
</style>
</head>
<body>
<header class="topbar">
  <a class="brand" href="login.html">
    <div class="brand-logo">R</div><span>Rutgers Attendance</span>
  </a>
  <nav class="top-actions">
    <a class="btn outline" href="#">Status &amp; Alerts</a>
    <a class="btn white" href="#" id="logoutBtn">Logout</a>
    <a class="btn ru" href="teacher.html" title="Switch to teacher (demo)">Teacher View</a>
  </nav>
</header>

<main class="cover">
  <div class="wrap">
    <!-- Header glass with student summary -->
    <section class="glass" id="summary">
      <h1 class="heading" id="welcome">Student Dashboard</h1>
      <p class="muted" id="subcopy">Loading…</p>
      <div class="kpi" id="kpis">
        <!-- KPI bubbles injected by JS -->
      </div>
    </section>

    <!-- Subjects grid -->
    <section class="grid" id="subjects">
      <!-- Subject cards injected by JS -->
    </section>

    <!-- Table view -->
    <section class="glass">
      <h2 style="margin:0 0 10px; color:#fff">Your subjects</h2>
      <div class="muted" style="margin-bottom:10px">Click a subject to open details (placeholders for now).</div>
      <div class="card" style="padding:0">
        <table>
          <thead>
            <tr>
              <th>Code</th>
              <th>Title</th>
              <th>Attendance</th>
              <th>Sessions</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="subjectsTable"></tbody>
        </table>
      </div>
    </section>
  </div>
</main>

<script>
  // Ensure we have student data
  function ensureStudent() {
    let s = localStorage.getItem("ru_student");
    if (s) return JSON.parse(s);
    const fallback = {
      email: "netid@rutgers.edu",
      name: "Jane Doe",
      subjects: [
        { code: "CS101", title: "Intro to CS", attendance: 92, totalSessions: 24, attended: 22 },
        { code: "MATH201", title: "Discrete Math", attendance: 88, totalSessions: 25, attended: 22 },
        { code: "BIO110", title: "Biology Lab", attendance: 95, totalSessions: 20, attended: 19 }
      ]
    };
    localStorage.setItem("ru_student", JSON.stringify(fallback));
    return fallback;
  }

  const student = ensureStudent();

  // Basic metrics
  const avg = Math.round(
    student.subjects.reduce((a,s)=>a+s.attendance,0) / student.subjects.length
  );
  const totalClasses = student.subjects.reduce((a,s)=>a+s.totalSessions,0);
  const totalAttended = student.subjects.reduce((a,s)=>a+s.attended,0);

  // Populate header
  document.getElementById('welcome').textContent = `Welcome, ${student.name}`;
  document.getElementById('subcopy').textContent = `${student.email} • ${student.subjects.length} subjects this term`;

  // KPI bubbles
  const kpis = document.getElementById('kpis');
  kpis.innerHTML = `
    <div class="bubble"><div class="label muted">Average attendance</div><div class="value">${avg}%</div></div>
    <div class="bubble"><div class="label muted">Sessions attended</div><div class="value">${totalAttended}/${totalClasses}</div></div>
    <div class="bubble"><div class="label muted">Subjects</div><div class="value">${student.subjects.length}</div></div>
    <div class="right">
      <a class="btn ru" href="#" onclick="alert('Coming soon: download summary PDF');return false;">Download summary</a>
    </div>
  `;

  // Render subject cards
  const grid = document.getElementById('subjects');
  grid.innerHTML = student.subjects.map((s, i) => {
    const pct = Math.max(0, Math.min(100, s.attendance));
    return `
      <article class="card subject" data-code="${s.code}">
        <div class="title">
          <div class="big">${s.title}</div>
          <span class="code">${s.code}</span>
        </div>
        <div class="muted">Attendance</div>
        <div class="bar" aria-label="attendance"><span style="width:${pct}%"></span></div>
        <div class="muted"><span class="stat">${pct}%</span> • ${s.attended}/${s.totalSessions} sessions</div>
        <div class="row">
          <a class="pill" href="#" onclick="openSubject('${s.code}');return false;">Open class</a>
          <a class="pill" href="#" onclick="viewHistory('${s.code}');return false;">View history</a>
        </div>
      </article>
    `;
  }).join('');

  // Table view
  const tbody = document.getElementById('subjectsTable');
  tbody.innerHTML = student.subjects.map(s => `
    <tr>
      <td><strong>${s.code}</strong></td>
      <td>${s.title}</td>
      <td>${s.attendance}%</td>
      <td>${s.attended}/${s.totalSessions}</td>
      <td style="text-align:right">
        <a class="pill" href="#" onclick="openSubject('${s.code}');return false;">Open</a>
      </td>
    </tr>
  `).join('');

  // Actions (stubs for now)
  function openSubject(code){
    // Save selected subject for a future subject_detail.html
    localStorage.setItem('ru_selected_subject', code);
    alert('Opening ' + code + ' (subject detail page coming next).');
    // location.href = 'subject.html'; // use when you create it
  }
  function viewHistory(code){
    alert('Attendance history for ' + code + ' (coming soon).');
  }

  // Logout returns to login
  document.getElementById('logoutBtn').addEventListener('click', (e)=>{
    e.preventDefault();
    // In real app, clear auth token; keep demo data for convenience
    location.href = 'login.html';
  });

  // Animate bars after paint
  requestAnimationFrame(()=>{
    document.querySelectorAll('.bar > span').forEach(el=>{
      const w = el.style.width; el.style.width='0';
      setTimeout(()=>{ el.style.transition='width .8s ease'; el.style.width = w; }, 0);
    });
  });
</script>
</body>
</html>
